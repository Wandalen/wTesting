# Розширені техніки

Описано прийоми і техніки, що роблять тест рутину зручною для читання і підтримки.

Приведені техніки не є обов'язковими, вони дозволяють структурувати дані в тест рутині, форматувати тест рутини для комфортної роботи.

### Структура тест рутини

Кожна тест рутина структурно ділиться на частину для позитивного тестування і для тестування правильності обробки помилкових вхідних даних об'єктом тестування.

Позитивне тестування - це основна частина тестового покриття. В ній тестується основний функціонал тест юніта. [Як наповнюється тест рутина](./TestRoutineStepByStep.md) і [базові техніки написання](./TestIntrospectorBasicTechnics) описані в відповідних туторіалах.

Якщо рутина тест юніта не викидає виключень і помилок, частина коду для тестування помилкових вхідних даних може бути відсутньою. Інакше, дану частину потрібно помістити після тестування базового функціоналу. Перед переходом до виконання коду з помилковими вхідними даними, бажано встановити перевірку встановлення опції `debug`:

```js
if( Config.debug )
{
  // some tests
}
```
або

```js
if( !Config.debug )
return;

// some tests
```

Тестування поведінки тест юніта при вводі помилкових вхідних даних проводиться з допомогою [спеціальних тест перевірок](../concept/TestCheck.md).

### Оформлення елементів тест рутини

Тест кейси включають опис тест кейсу, змінні для здійснення тестового випадку, тестовий випадок та тест перевірки. Всі елементи йдуть послідовно, кожен з нового рядка, при необхідності, окремі елементи можуть відділятись порожнім рядком. При цьому не має бути конфліктів з іншими частинами форматування рутини.

```js
test.case = 'ins is number';
var equalizer = ( el, arrEl ) => el === arrEl[ 0 ];
var got = _.arrayRemove( [ 1, 2, 3 ], 3, equalizer );
var expected = [ 1, 2, 3 ];
test.identical( got, expected );
```

Якщо використовуються окремі тест перевірки, їх потрібно описати так же як і тест кейс, з допомогою функціоналу утиліти.

```js
test.description = 'one character';
test.identical( _.strCount( 'abc', 'a' ), 1 );
```

Важливо зазначити,що форматування окремих елементів тест рутини має бути однаковим. Зміна порядку об'явлення змінних чи зміна форматування елементів тест рутини забирає час на дослідження відмінностей.

### Групування тест кейсів

В туторіалі з описом базових технік указано, що опис тест кейсу може містити спільну частину. За цією спільною частиною тест кейси збираються в групи. Утиліта `Тестінг` має спеціальну синтаксичну конструкцію для створення груп тест кейсів.

Тест група відкривається з допомогою методу `open`, а закривається методом `close`. Аргументом методу передається рядок з назвою тест групи. Цей рядок буде додано в вивід тест рутини перед назвою тест перевірок, що входять в групу. Для того, щоб утиліта зрозуміла яку групу потрібно закрити, аргумент в методі `close` має бути ідентичним переданому в метод `open`.

```js
test.open( 'dst is Array' );

// test cases

test.close( 'dst is Array' );
```

В приведеному прикладі створено тест групу `dst is Array`. В тілі тест групи мають розміщуватись відповідні тест кейси.

Перевагою використання синтаксичної конструкції полягає в тому, що з описів тест кейсів можна видалити спільну частину назви. Вилучену частину опису можна помістити в назву тест групи. В такому разі відмінності в описі окремих тест кейсів будуть більш помітними. Крім цього, тест групи візуально більш помітні і чітко вказують на межі груп.

### Розділення елементів тест рутин

Для відділення однієї тест рутини від іншої використовується коментар `//`, поміщений між двома порожніми рядками.

```js
function test1( test )
{
  // some tests
}

//

function test2( test )
```

Тест кейси відділяються один від одного порожнім рядком або рядком з коментарем `/* */`, котрий поміщений між двох порожніх рядків.

```js
test.case = 'ins is number';
var got = _.arrayRemove( [ 1, 2, 3 ], 3 );
var expected = [ 1, 2 ];
test.identical( got, expected );

test.case = 'ins is string';
var got = _.arrayRemove( [ 1, 2, 3 ], '3' );
var expected = [ 1, 2, 3 ];
test.identical( got, expected );

/* */

test.case = 'ins is array';
```

Коментар `/* */` використовується для відділення невеликих тест груп в яких змінються умови виконання тестування. Також, такий коментар використовується якщо одиничний тест кейс має значний об'єм. Дана техніка дозволяє швидко знаходити межі окремих тест кейсів.

Окремі тест перевірки відділяються як і тест кейси.

Для того, щоб відділити тест групи використовується коментар `/* - */`, що поміщений між двома порожніми рядками.

```js
test.close( 'one argument' );

/* - */

test.open( 'two arguments' );
```

Вказані рекомендації допомагають розробнику орієнтуватись в структурі тест рутини. При цьому зменшується кількість звернень до опису окремих тест перевірок та покращується навігація по тест рутині.


### Підсумок

- Тест рутина умовно ділиться на дві частини - тестування штатної поведінки тест юніта і тестування при вводі помилкових тестових даних.
- Тестування штатної поведінки обов'язкове, а при вводі помилкових вхідних даних - опціональне.
- Тест кейси і тест перевірки можна об'єднати в тест групи.
- Форматування даних тест рутини важлива складова. Правильне форматування дозволяє швидко орієнтуватись в структурі тест рутини і аналізувати використані дані.

[Повернутись до змісту](../README.md#Туторіали)

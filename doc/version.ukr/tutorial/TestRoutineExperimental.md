# Експериментальна тест рутина

Створення експериментальних тест рутин ( експериментів ) як інструмент для дослідження і комунікації між членами команди розробників.

Експеримент це особлива тест рутина, що не виконується за замовчуванням. За допомогою експерименту розробник може включити код який не є тестом в тест сюїт і виконати його в такому ж середовищі в якому виконується тестування.

Відстань між окремими членами команди, а також складність пояснень можуть погіршити розуміння між членами команди. Експериментальні тест рутини призначені для покращення діалогу між розробниками. Краще один раз побачити ніж 7-м разів почути.

Експериментальні тест рутини зручно використовувати для відлагодження та уточнення поведінки тест юніта. В експериментальну тест рутину можливо помістити необхідний експериментальний код отримавши при цьому таке ж середовище, як і в тест рутини. Іншому розробнику буде легко знайти експериментальну тест рутину і зрозуміти першого. Те що експерименти не мають впливу на звіт тестування дуже зручно.

### Приклад

Для ознайомленням із цією фічою створіть тест сюїт `Expriment.test.js` і повторіть дії описані нижче.

Модуль має один тестовий файл - `Expriment.test.js` в якому поміщено дві тест рутини - одну звичайну та другу - експериментальну. Для простоти реалізуємо тестування стандартної рутини `Math.sqrt`. Припустимо `Math.sqrt` не є стандартною, має поганий опис і мета розробника дослідити її.

<details>
<summary><u>Код файла <code>Experiment.test.js</code></u></summary>

```js

let _ = require( `wTesting` );

//

function sqrtTest( test )
{
  test.case = `integer`;
  test.identical( Math.sqrt( 4 ), 2 );
}

//

function experiment( test )
{
  test.case = `strings`;
  test.identical( Math.sqrt( -1 ), `?` );
}
experiment.experimental = true;

//

var Self =
{
name : `Experiment`,
  tests :
  {
    sqrtTest,
    experiment,
  }
}

//

Self = wTestSuite( Self );
if( typeof module !== `undefined` && !module.parent )
wTester.test( Self.name );

```

</details>

Внесіть приведений вище код в файл `Expriment.test.js`.

Рутина `Math.sqrt` повертає квадратний корінь числа. Тест рутина `sqrtTest` виконує примітивне тестування `Math.sqrt`.

Припустимо розробник не має чіткого розуміння, як саме `Math.sqrt` має реагувати на негативні числа. В такому разі розробник може її дослідити написавши експеримент. Експеримент після дослідження можна перетворити в повноцінну тест рутину або поділитися ним із членами команди.

Рутина `experiment` є експериментальною, вона перевіряє аспект роботи уніта, котрий є незрозумілим для розробника. Щоб зробити тест рутину експериментальною присвойте полю `experimental` цієї рутини `true`.

```js
sqrtTestExperiment.experimental = true;
```

### Виконання

Запустіть тест сюїт `Expriment.test.js`. Для цього введіть команду `node Experiment.test.js` в директорії з файлом.

<details>
<summary><u>Вивід команди <code>tst .run ./Experiment.test.js</code></u></summary>

```
$ node Experiment.test.js

Running test suite ( Experiment ) ..
Located at Experiment.test.js:34
Passed TestSuite::Experiment / TestRoutine::sqrtTest in 0.031s
Passed test checks 1 / 1
Passed test cases 1 / 1
Passed test routines 1 / 1
Test suite ( Experiment ) ... in 0.601s ... ok

```

</details>

Вище наведений фрагмент звіту тестування. З нього стає очевидним що було виконано лише одну тест рутину `sqrtTest` попри те що в тест сюїті їх дві. Друга рутина `experiment` експериментальна тому її виконано не було.

Для того щоб виконати експериментальну тест рутину [запустіть її явно](./Running.md) за допомогою команди `node Experiment.test.js r:experiment`.

<details>
<summary><u>Вивід команди <code>tst .run ./Experiment.test.js r:sumTestExperiment</code></u></summary>

```
$ node Experiment.test.js r:experiment

Running test suite ( Experiment ) ..
Located at Experiment.test.js:34

Running TestSuite::Experiment / TestRoutine::experiment ..
- got :
NaN
- expected :
'?'

Test check ( TestSuite::Experiment / TestRoutine::experiment / strings # 1 ) ... failed
Failed TestSuite::Experiment / TestRoutine::experiment in 0.084s
Passed test checks 0 / 1
Passed test cases 0 / 1
Passed test routines 0 / 1
Test suite ( Experiment ) ... in 0.169s ... failed
```

</details>

Вище наведено фрагмент виводу експерименту `experiment`. Так як ім'я експерименту було вказано явно то його було виконано. Експеримент може мати, будь який код, а також тестові перевірки як і звичайна тест рутина. В даному випадку експеримент має єдину тестову перевірку і вона провалюється так, як `Math.sqrt( -1 )` повертає не `'?'`.

### Чому

Виникає логічне питання: чому просто не винести код, що має бути в експерименті в окремий незалежний файл. Є ряд причин через, які розробник може бути зацікавлений тримати експеримент в тест сюїті. Чому винести експериментальний код в окремий JS файл може бути не ліпшим рішенням?

- Експеримент виконується в точно такому ж середовищі, як і звичайна тест рутина, що не гарантується окремо-стоячим JS файлом.
- Зручно мати увесь споріднений код в одному місці. Експерименти часто споріднені із тестами і часто в них перетворюються.
- З експерименту простіше зробити тест рутину ніж із окремо-стоячого JS файла.

### Підсумок

- Експериментальні тест рутини не виконуються, якщо це не вказано явно.
- Для створення експеремента потрібно встановити поле `experimental` в `true` цієї тест рутини.
- По-замовчуванню, експеременти не має впливу на звіт тестування.
- Експеременти призначені для спрощення взаємодії між командою розробників при використанні спільного коду, для уточнення деталей реалізації і поведінки коду.
- Експериментальні тест рутини зручно використовувати для дослідів.

[Повернутись до змісту](../README.md#tutorials)
